<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TASLP 2025 · DIL Demo</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; color: #111; }
    .container { max-width: 980px; margin: 0 auto; padding: 28px 18px 60px; }
    a { color: inherit; }

    .topbar { margin-bottom: 16px; }
    .topbar a { text-decoration: none; color: #333; }
    .topbar a:hover { text-decoration: underline; }

    h1 { margin: 10px 0 6px; text-align: center; }
    .meta { text-align: center; color: #666; margin-bottom: 6px; }
    .subtitle { text-align: center; color: #555; margin: 0 0 18px; line-height: 1.45; }

    .tabs { display: flex; gap: 8px; justify-content: center; margin: 18px 0 10px; overflow-x: auto; padding-bottom: 6px; }
    .tab-button { padding: 10px 12px; cursor: pointer; border: 1px solid #ddd; background: #f4f4f4; border-radius: 999px; white-space: nowrap; flex: 0 0 auto; }
    .tab-button.active { background: #4CAF50; color: white; border-color: #4CAF50; }

    .tab-content { display: none; margin-top: 18px; }
    .tab-content.active { display: block; }

    .card { border: 1px solid #eee; border-radius: 14px; padding: 16px 14px; margin: 14px 0; background: #fff; }
    .card h2, .card h3 { margin: 0 0 10px; }

    .row { display: grid; grid-template-columns: 230px 1fr; gap: 12px; align-items: center; margin: 10px 0; }
    .label { font-weight: bold; text-align: left; color: #222; }
    audio { width: 100%; }

    .hint { color: #666; margin-top: 6px; line-height: 1.45; }
    .small { font-size: 13px; color: #666; }

    .btnrow { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .btn { display: inline-block; padding: 9px 12px; border-radius: 12px; background: #4CAF50; color: white; text-decoration: none; font-size: 14px; }
    .btn.secondary { background: #eaeaea; color: #111; }

    code { background: #fafafa; border: 1px solid #eee; padding: 2px 6px; border-radius: 8px; }

    @media (max-width: 700px) {
      .row { grid-template-columns: 1fr; }
      .label { margin-bottom: -4px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="topbar">
      <a href="../../index.html">← Back to Demos</a>
    </div>

    <h1>TASLP 2025 · DIL Demo</h1>
    <div class="meta">Companion page (audio examples + index download)</div>
    <p class="subtitle">
      Tabs correspond to different H1 rooms (<b>803 / 508 / 403</b>). Each example includes clean, observed (reverb),
      three baselines (WPE/DFN/BuDDy), and DIL variants (oracle and mismatch settings).
    </p>

    <div class="tabs">
      <button class="tab-button active" onclick="openTab('h1_803')">H1 = 803</button>
      <button class="tab-button" onclick="openTab('h1_508')">H1 = 508</button>
      <button class="tab-button" onclick="openTab('h1_403')">H1 = 403</button>
      <button class="tab-button" onclick="openTab('downloads')">Downloads</button>
    </div>

    <div id="h1_803" class="tab-content active">
      <div class="card">
        <h2>H1 = 803</h2>
        <p class="small">
          DIL mismatch-1: H2 chosen from remaining RIRs in the same room as H1. <br/>
          DIL mismatch-2: H2 chosen from a different room than H1.
        </p>
      </div>
      <div id="list_803"></div>
    </div>

    <div id="h1_508" class="tab-content">
      <div class="card">
        <h2>H1 = 508</h2>
      </div>
      <div id="list_508"></div>
    </div>

    <div id="h1_403" class="tab-content">
      <div class="card">
        <h2>H1 = 403</h2>
      </div>
      <div id="list_403"></div>
    </div>

    <div id="downloads" class="tab-content">
      <div class="card">
        <h2>Downloads</h2>
        <div class="btnrow">
          <a class="btn" href="./h1_index.npy" download>Download H1 index (.npy)</a>
          <a class="btn secondary" href="#" target="_blank" rel="noopener">Code (GitHub)</a>
        </div>
        <p class="small" style="margin-top: 10px;">
          If the index file has not been uploaded yet, this link may temporarily return 404 and will be updated.
        </p>
      </div>
    </div>
  </div>

  <script>
    function openTab(tabId) {
      document.querySelectorAll("audio").forEach(a => { a.pause(); a.currentTime = 0; });
      document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));
      document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
      document.getElementById(tabId).classList.add("active");
      const btn = Array.from(document.querySelectorAll(".tab-button"))
        .find(b => b.getAttribute("onclick") === `openTab('${tabId}')`);
      if (btn) btn.classList.add("active");
    }

    // Page: /demos/papers/taslp2025-dil/
    // Audio: /audio/taslp2025-dil/<folder>/<base>*.wav
    const AUDIO_ROOT = "../../../audio/taslp2025-dil";

    // Your samples (from your commit output)
    const TRIALS = [
      { h1: "403", folder: "trial1_h1_403", base: "ieee25f08" },
      { h1: "403", folder: "trial1_h1_403", base: "ieee70m03" },

      { h1: "508", folder: "trial1_h1_508", base: "ieee26f02" },
      { h1: "508", folder: "trial1_h1_508", base: "ieee52m01" },

      { h1: "803", folder: "trial1_h1_803", base: "ieee03f08" },
      { h1: "803", folder: "trial1_h1_803", base: "ieee71m04" }
    ];

    // Track list (observed supports BOTH _noisy.wav and _reverb.wav)
    const TRACKS = [
      { label: "Clean", suffixes: [".wav"] },
      { label: "Observed (Reverb)", suffixes: ["_noisy.wav", "_reverb.wav"] },
      { label: "WPE", suffixes: ["_wpe.wav"] },
      { label: "DFN", suffixes: ["_dfn.wav"] },
      { label: "BuDDy", suffixes: ["_buddy.wav"] },
      { label: "DIL (Oracle)", suffixes: ["_dil_oracle.wav"] },
      { label: "DIL mismatch-1 (same room)", suffixes: ["_dil_mismatch1.wav"], optional: true },
      { label: "DIL mismatch-2 (diff room)", suffixes: ["_dil_mismatch2.wav"], optional: true }
    ];

    function el(tag, attrs = {}, children = []) {
      const n = document.createElement(tag);
      Object.entries(attrs).forEach(([k,v]) => {
        if (k === "class") n.className = v;
        else if (k === "html") n.innerHTML = v;
        else n.setAttribute(k, v);
      });
      children.forEach(c => n.appendChild(c));
      return n;
    }

    async function exists(url) {
      try {
        const r = await fetch(url, { method: "HEAD" });
        return r.ok;
      } catch (e) { return false; }
    }

    async function resolveFirstExisting(basePath, suffixes) {
      for (const s of suffixes) {
        const url = `${basePath}${s}`;
        if (await exists(url)) return url;
      }
      return null;
    }

    async function renderOneTrial(t) {
      const card = el("div", { class: "card" });
      card.appendChild(el("h3", { html: `Folder: <code>${t.folder}</code> · Sample: <code>${t.base}</code>` }));

      const basePath = `${AUDIO_ROOT}/${t.folder}/${t.base}`;

      for (const tr of TRACKS) {
        const url = await resolveFirstExisting(basePath, tr.suffixes);

        if (!url) {
          if (tr.optional) continue; // optional track missing -> hide
          // non-optional missing -> show a note instead of a broken player
          card.appendChild(el("div", { class: "small", html: `Missing: <code>${t.base}${tr.suffixes[0]}</code>` }));
          continue;
        }

        const row = el("div", { class: "row" });
        row.appendChild(el("div", { class: "label", html: tr.label }));

        const audio = el("audio", { controls: "" });
        audio.appendChild(el("source", { src: url, type: "audio/wav" }));
        row.appendChild(audio);

        card.appendChild(row);
      }

      return card;
    }

    async function renderTrials(h1Value, containerId) {
      const container = document.getElementById(containerId);
      const items = TRIALS.filter(x => x.h1 === h1Value);

      for (const t of items) {
        container.appendChild(await renderOneTrial(t));
      }
    }

    (async function init() {
      await renderTrials("803", "list_803");
      await renderTrials("508", "list_508");
      await renderTrials("403", "list_403");
    })();
  </script>
</body>
</html>
